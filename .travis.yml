language: ruby
rvm:
- 2.1.2
addons:
  postgresql: '9.3'
install:
- npm install
- npm run bundle
- bundle install --without development --deployment
before_script:
- psql -c 'create database asm_test;' -U postgres
- cp config/database.yml.travis config/database.yml
- bin/rake db:schema:load
cache:
  directories:
  - vendor/bundle
  - node_modules
services:
- redis-server
- elasticsearch
deploy:
  provider: heroku
  strategy: git
  app:
    secure: gv+O69pvNInWcQUSRwjPS2Fu+5gKwSTkiEzQ8KkOMygBTa1btS8DWpvQUtkxtEyXDwTz7P5UNYNNsRcL1/UCB6Xl3UknnTK825yTMfX3UDKAhNQ0+Zw0GtqXx9xXnfPthhBYGK7g2aKhoou4eJwkDIBVytmMsTxFj+fwnTSRnRo=
  run:
    - "rake db:migrate"
    - restart
    - "rake cleanup"
  api_key:
    secure: TBU1zA2xMr0MBJTPiLIkCM92UczOxOM3a4ChAH48HjGvw9TSRB5faGY/HiIMJG0MjUMohlLINjQ7RvZlH9CH3yplWZiDSrsQvbpaGrK3WE8PHC/DOvwzfBoNKRYZqcFkWtyoO5JlAU51g877SjPpzW0Ec5iamCqzUTf9OhaIWlo=
env:
  global:
    secure: e5U3AYlkOhCiDJxHnR+tAkARa+EL3mcKYQujnerIkXxcCHz2D2cRgYutGYb6sfZxZaspZsk62EyxGTeEcCJP5D5ANaOkpQ4qdSjznHRJdjiEcM2+XBUsRXgTQeeXbtpG5uW+gX9DlFf0e1149RHXErdR0WiUdrHpRKnAU8LOV48=
