<% title "Bounties", @product.name %>
<% activate_nav! :bounties %>
<%= track 'product.wips.viewed', ProductAnalyticsSerializer.new(@product) %>

<% if @project.nil? %>
  <%= render 'bounties/header'  %>
<% else %>
  <%= render 'bounties/project_header' %>
<% end %>

<% if @product.tasks.any? %>
  <div class="row">
    <div class="col-md-9">
      <% if @project %>
        <div class="markdown markdown-normalized large" style="margin-bottom: 48px">
          <%== product_markdown(@project.product, @project.description) %>
        </div>
      <% end %>

      <% if @wips.any? %>
        <ol class="list-group list-group-breakout list-group-padded" id="wips-view-el">
          <% @wips.each do |task| %>
            <li class="list-group-item"><%= render 'bounties/chip', bounty: task %></li>
          <% end %>
        </ol>

        <% if @wips.total_pages > 1 %>
          <hr>

          <%= paginate @wips, theme: 'twitter-bootstrap-3' %>
        <% end %>
      <% end %>
    </div>

  <div class="col-md-3">
    <div class="panel">
      <div data-react-class="CreateBountyButton" data-react-props="<%= {
        classes: 'btn btn-default btn-block',
        product: { name: @product.name },
        url: product_wips_path(@product),
        maxOffer: (6 * @product.average_bounty).round(-4),
        averageBounty: @product.average_bounty,
        coinsMinted: @product.coins_minted,
        profitLastMonth: @product.profit_last_month,
        steps: BountyGuidance::Valuations.suggestions(@product),
        createBountyShown: params['modal'] == 'true'
      }.to_json %>"></div>
    </div>

    <%= render 'bounties/projects_filter', projects: @milestones %>
  </div>

  <% else %>
    <div class="col-md-6 col-md-offset-3">
      <div class="well well-lg omega">
        <h3 class="alpha"><strong>Create the first bounty</strong></h3>
        <p class="text-muted">
          Get started by breaking down a new idea into bite-sized chunks
          that can valued and prioritized. Writing a great description will
          make it super easy for anyone to jump in and get to work.
        </p>

        <div data-react-class="CreateBountyButton" data-react-props="<%= {
          product: { name: @product.name },
          url: product_wips_path(@product),
          maxOffer: (6 * @product.average_bounty).round(-4),
          averageBounty: @product.average_bounty,
          coinsMinted: @product.coins_minted,
          profitLastMonth: @product.profit_last_month,
          steps: BountyGuidance::Valuations.suggestions(@product)
        }.to_json %>" class="omega text-center"></div>
      </div>
    </div>
  </div><!-- .row -->
<% end %>
