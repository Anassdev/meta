<% title @product.name, @product.pitch %>
<% activate_nav! :idea %>
<%= track 'product.viewed', ProductAnalyticsSerializer.new(@product, scope: current_user) %>

<div class="row">
  <div class="col-md-7">
    <% if @product.you_tube_video_url? %>
      <div class="embed-responsive embed-responsive-16by9">
        <iframe
          class="embed-responsive-item"
          width="853"
          height="480"
          src="<%= @product.you_tube_video_embed_url %>"
          frameborder="0"
          allowfullscreen
        ></iframe>
      </div>
      <hr>
    <% end %>

    <div class="markdown markdown-normalized text-large">
      <% if @product.lead.present? %>
        <div class="lead">
          <%= product_markdown(@product, @product.lead) %>
        </div>
      <% end %>

      <%== @product.description_html %>

      <% (@product.info || {}).each do |field, value| %>
        <% if value.present? %>
          <h2><%= field.titlecase %></h2>
          <%== markdown(value) %>
        <% end %>
      <% end %>
    </div>

  </div>

  <div class="col-md-4 col-md-offset-1">

    <a href="<%= product_tasks_path(@product) %>" class="btn btn-lg btn-success btn-block">Build this product with us</a>

    <br>


    <div class="stat-group">
      <div class="stat">
        <div class="stat-value"><%= @product.posts.count %></div>
        <div class="stat-title">Updates</div>
      </div>

      <div class="stat">
        <div class="stat-value"><%= @product.tasks.open.count %></div>
        <div class="stat-title">Bounties</div>
      </div>

      <div class="stat">
        <div class="stat-value"><%= @product.partners_count %></div>
        <div class="stat-title">Partners</div>
      </div>
    </div>

    <% if @product.teambuilding? %>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h6 class="panel-title">Team Building</h6>
        </div>
        <div class="panel-body">
          <p>
            This product is growing a team. It needs to reach <strong>10 partners</strong> in
            <strong>30 days</strong> before it is Greenlit. You can become a partner by
            <a href="<%= product_tasks_path(@product) %>">completing a bounty</a>.</p>

          <div class="progress progress-sm" style="margin-bottom:6px">
            <div class="progress-bar progress-bar-success" style="width:<%= ((@product.partners_count / 10.0) * 100).round %>%"></div>
          </div>

          <div class="clearfix">
            <div class="pull-left"><%= pluralize(@product.partners_count, 'partner') %></div>
            <div class="pull-right"><%= pluralize(@product.teambuilding_days_left, 'day') %> left</div>
          </div>

        </div>
      </div>
    <% end %>

    <h6 class="text-muted">Core Team</h6>

    <div class="list-group list-group-breakout">
      <% @product.core_team.each do |user| %>
        <a class="list-group-item" href="<%= user_path(user) %>">
          <div class="chip chip-sm">
            <span class="chip-icon"><%= avatar_tag(user) %></span>
            <span class="text-primary"><%= user.username %></span>
            <% if user.bio.present? %>
              &mdash;
              <span class="text-muted"><%= user.bio %></span>
            <% end %>
          </div>
        </a>
      <% end %>
    </div>

    <h6 class="text-muted">Other links</h6>
    <ul class="list-unstyled large omega">
      <% if @product.homepage_url.present? %>
        <li><a href="<%= @product.homepage_url %>">Homepage</a></li>
      <% end %>

      <% if @product.chat_rooms.any? %>
        <% chat_room = @product.chat_rooms.first %>
        <li><a href="<%= chat_room_path(chat_room) %>">Chat</a></li>
      <% end %>

      <li><a href="<%= product_projects_path(@product) %>">Projects</a></li>
      <li><a href="<%= product_discussions_path(@product) %>">Discussions</a></li>
      <li><a href="<%= product_assets_path(@product) %>">Assets</a></li>
      <li><a href="<%= product_repos_path(@product) %>">Repositories</a></li>
    </ul>

  </div>

</div>
