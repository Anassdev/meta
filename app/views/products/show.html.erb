<% title @product.name, @product.pitch %>
<% activate_nav! :product %>

<div class="row">
  <div class="col-md-8 col-xs-8">

    <!-- Pitch -->

    <h2 class="alpha"><strong><%= @product.pitch %></strong></h2>

    <% unless @product.lead.blank? %>
      <div class="text-large">
        <%== @product.lead_html %>
      </div>
    <% end %>

    <!-- Poster Image -->
    <hr>


    <!-- Body -->
    <div class="markdown-normalized text-longform">
      <%== @product.description_html %>
    </div>
  </div>


  <div class="col-md-3 col-xs-3 col-md-offset-1 col-xs-offset-1">
    <%= render 'products/sidebar' %>

    <!-- Social links -->

    <%#= render 'products/social_buttons' %>

    <% cache [@product, 'links'] do %>
      <%= render 'products/links' %>
      <%= render 'products/people' %>
    <% end %>

    <%= render 'products/metrics' %>

    <% cache [@product, 'tags'] do %>
      <%= render 'products/tags_panel' %>
    <% end %>

    <% if can?(:update, @product) %>
      <div class="btn-group-vertical btn-block">
        <a class="btn btn-default" href="<%= edit_product_path(@product) %>">Edit Product</a>
        <a class="btn btn-default" href="<%=  new_product_post_path(@product) %>">Write blog post</a>
      </div>
    <% end %>

    <% if staff? %>
      <br><br>
      <div class="panel panel-danger">
        <div class="panel-heading">
          <h6 class="panel-title">DANGER</h6>
        </div>
        <div class="panel-body">
          <% if @product.flagged? %>
            <span class="btn btn-danger btn-sm btn-block btn-disabled" href="#>">Product Flagged</span>
          <% else %>
            <a class="btn btn-danger btn-sm btn-block" href="<%= product_flag_path(@product)%>">Flag Product</a>
          <% end %>

          <br>

          <%= form_for [:admin, @product.showcases.new], url: admin_staff_picks_path do |f| %>
            <%= f.hidden_field :product_id %>
            <%= f.submit "Schedule Staff Pick", class: %w(btn btn-default btn-sm btn-block) %>
          <% end %>
        </div>
      </div>
    <% end %>

  </div>
</div><!-- .row -->

<% if current_user.try(:staff?) != true %>
  <script>
    analytics.track('product.viewed', <%==
      ProductAnalyticsSerializer.new(@product, scope: current_user).to_json
    %>);
  </script>
<% end %>
