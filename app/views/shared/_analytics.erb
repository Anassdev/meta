<script type="text/javascript">
<% if ENV['SEGMENT_API_KEY'].present? %>
  var analytics=analytics||[];(function(){var e=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group"],t=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var n=0;n<e.length;n++)analytics[e[n]]=t(e[n])})(),analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)};
  analytics.load(<%= ENV['SEGMENT_API_KEY'].to_json.html_safe %>);
<% else %>

  // debugging
  window.analytics = {
    identify: function(e){
      console.log('analytics identify:', e, arguments);
    },
    alias: function(e) {
      console.log('analytics alias:', e, arguments);
    },
    track: function(e) {
      console.log('analytics track:', e, arguments);
    },
    trackLink: function(links, name, properties) {
      $(links).on('click', function(e){
        e.preventDefault()
        console.log('analytics trackLink:', name, properties);
        setTimeout(function(){
          window.location.href = $(e.target).closest('a').attr('href')
        }, 10); // bump this up if you want to see the analytics call
      });
    }
  }
<% end %>
</script>
