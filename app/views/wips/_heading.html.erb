<div class="page-heading">

  <!--
    This doesn't really belong here. Eventually we'll want this to be fixed as
    the user scrolls down a discussion. `.page-heading-sidebar` won't get used
    anywhere else. It's convenient for the moment, though.
  -->
  <ol class="breadcrumb">
    <li><a href="<%= product_wips_path(@wip.product) %>">Tasks</a></li>
  </ol>

  <div class="page-heading-actions">
    <a class="btn btn-default" href="<%= new_product_wip_path(@wip.product) %>">
      Create a new task
    </a>
  </div>

  <div class="page-heading-title">
    <a href="<%= product_wip_path(@wip.product, @wip) %>">
      <%= @wip.title %>
      <small>#<%= @wip.number %></small>
    </a>
  </div>

  <div class="page-heading-meta">
      <ul class="list list-meta pull-right">
        <li class="list-item">
          <%= render partial: 'add_to_milestone' %>
        </li>
        <% if can?(:edit, @wip) %>
          <li class="list-item">
            <a class="text-yellow" href="<%= edit_product_wip_path(@wip.product, @wip) %>">Edit Task</a>
          </li>
        <% end %>
      </ul>

    <div class="mint-gutter">
      <%= render 'shared/coin_vote', voteable: @wip %>

      <ul class="list list-meta non-affixed">
        <li class="list-item">
          Created by
          <a href="<%= user_path(@wip.user) %>"><%= @wip.user.username %></a>
        </li>
        <li class="list-item">
          <%= pluralize(@wip.comments.count, 'comments') %>
        </li>
        <li class="list-item">
          <%= pluralize(@wip.watchers.count, 'watchers') %>
        </li>
        <li class="list-item">
          <div class="label"><%= @wip.deliverable %></div>

          <% if @wip.promoted? %>
            <div class="label label-promoted">Promoted</div>
          <% end %>
        </li>
      </ul>

      <div class="affixed">
        <strong><%= @wip.title %></strong>
      </div>
    </div>
  </div>

</div>

<script>
  $(document).ready(function(){
    var top = $('.page-heading-meta').offset().top - 20;
    $('.page-heading-meta').affix({
      offset: {
        top: top
      }
    })
  });
</script>