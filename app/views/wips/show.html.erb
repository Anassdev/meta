<% title @wip.title, "##{@wip.number}", @wip.product.name %>

<%= render 'shared/navbar' %>
<%= render 'products/navbar' %>

<div class="page <%= 'non-profit' if !@product.for_profit?%>">
  <div class="container">

    <%= render 'header' %>
    <div class="row">
      <div class="col-md-8 col-xs-8">
        <div id="discussion-view-el">
          <%= render 'wips/discussion', events: @events %>

          <div class="well js-upvote-reminder" style="display:none">
            You've commented on this Bounty but you haven't upvoted. Your upvotes reward people with more coins for completing Bounties which helps make <%= @product.name %> a better product.
          </div>

          <%= render 'new_event_form' %>
        </div>
      </div>

      <div class="col-md-3 col-xs-3 col-md-offset-1 col-xs-offset-1">
        <%= render partial: 'tasks/task_sidebar' %>
      </div>
    </div>
  </div>
</div>

<% if signed_in? %>
  <img class="hidden" src="<%= ReadraptorTracker.new(ReadRaptorSerializer.serialize_entities(@wip).first, current_user.id).url %>" />
<% end %>

<%= render 'shared/footer' %>

<script>
  app.wip = new Wip(<%== WipSerializer.new(@wip, scope: current_user).to_json %>);
  app.wipEvents = new WipEvents(<%== ActiveModel::ArraySerializer.new(@wip.events).to_json %>, {
    url: '<%= product_wip_comments_path(@wip.product, @wip) %>'
  });

  $(document).ready(function() {
    app.discussionView = new DiscussionView({
      el: $('#discussion-view-el'),
      tipsPath: '<%= product_tips_path(@wip.product) %>',
      model: app.wip
    });
  })

  analytics.track('product.wip.viewed', <%== WipAnalyticsSerializer.new(@wip, scope: current_user).to_json %>)
</script>
